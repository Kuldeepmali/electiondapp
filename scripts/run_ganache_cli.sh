#!/usr/bin/env bash

# Executes cleanup function at script exit.trap cleanup EXIT

cleanup() {
  if [ -n "$ganache_cli_pid" ] && ps -p $ganache_cli_pid > /dev/null; then
    kill -9 $ganache_cli_pid
  fi
}

ganache_cli_running() {
  nc -z localhost 8545
}

run_ganache_cli() {
  ganache-cli --account="0xCD3D9F6592E22FCFFF8C9F8BB0570D7B73BDDEE68DEDFD1DBE6E12BA76A7E8F3, 100000000000000000000000000000000" --account="0x93B7E0326651E4003EA45ACB812B77B115DD0D2D2A6A7DA2187A6E773EA58A32, 100000000000000000000000000000000" --account="0x1567DA9A7A781A76D5FFD831558895A9AD472C4A417CCF576BED845E383B783C, 100000000000000000000000000000000" --account="0xC198C132387A3EE4798D91154D9E85647224473999239E6039B43F20AD80FC01, 100000000000000000000000000000000" --account="0x91D140468A21EC7EC08884C1C271C1C8CACB1CBA8AA3DA006AEBFBFF1900AEFF, 100000000000000000000000000000000" --account="0x76C03AC3F25CFEF28F07219F6DE78224FF3AC4B69C56E971EBB4CD4489287A90, 100000000000000000000000000000000" --account="0x2E6EB299A39CB58BBC8509E457AEE008759191D6ED5128804643A200DB723378, 100000000000000000000000000000000" --account="0x5CC76DD0C20CDCCF49CF90A5F84B49E9A49BD5A25B79DFE1D647A5B93BAF0BD5, 100000000000000000000000000000000" --account="0x5DD057F1C0C3BD0A503511AACC5F01340E461B32C79170A1558F84B0C5CA11CA, 100000000000000000000000000000000" --account="0xCD5C174A410EDD340EB70B400A2EEE2CAABE5CC283FD43891BB6E24A228CFC5C, 100000000000000000000000000000000"
}

if ganache_cli_running; then
  echo "Using existing ganache-cli instance"
else
  echo "Starting our own ganache-cli instance"
  run_ganache_cli
  ganache_cli_pid=$!
fi
